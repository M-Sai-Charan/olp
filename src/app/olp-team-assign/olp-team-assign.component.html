<p-table [value]="events" dataKey="eventId" class="p-mb-3">
  <ng-template pTemplate="header">
    <tr>
      <th>Customer</th>
      <th>Event</th>
      <th>Date</th>
      <th>Assigned Team</th>
      <th>Actions</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-event>
    <tr>
      <td>{{ event.customer }}</td>
      <td>{{ event.name }}</td>
      <td>{{ event.date }}</td>
      <td>
        <ng-container *ngIf="event.assignedTeam.length; else noTeam">
          <div class="assigned-team">
            <ng-container *ngFor="let member of event.assignedTeam">
              <div class="avatar tooltip" [ngClass]="getRoleClass(member.role)">
                {{ getInitials(member.name) }}
                <span class="tooltiptext">{{ member.name }} - {{ member.role }}</span>
              </div>
            </ng-container>
          </div>
        </ng-container>
        <ng-template #noTeam>
          <span class="p-text-secondary">No team assigned</span>
        </ng-template>
      </td>
      <td>
        <button pButton type="button" label="Assign Team" icon="pi pi-users" class="p-button-sm p-button-outlined"
                (click)="openAssignDialog(event)"></button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog header="Assign Team" [(visible)]="displayDialog" [modal]="true" [style]="{ width: '40vw' }">
  <div class="p-fluid">
    <div *ngFor="let role of roles">
      <p-dropdown
        [options]="getAvailableEmployees(role)"
        [(ngModel)]="selectedAssignments[role]"
        optionLabel="name"
        placeholder="Select {{ role }}"
        [filter]="true"
        appendTo="body"
        [showClear]="true"
      ></p-dropdown>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton label="Cancel" icon="pi pi-times" (click)="displayDialog = false" class="p-button-text"></button>
    <button pButton label="Save" icon="pi pi-check" (click)="assignTeam()" class="p-button-success"></button>
  </ng-template>
</p-dialog>

<p-toast></p-toast>
